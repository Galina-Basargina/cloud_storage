<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | Cloud Storage</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="logo">
            <a href="index.html"><img src="logo-e0e0e0.png" alt="Cloud Logo"></a>
        </div>
        
        <h1>–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h1>
        
        <form id="registrationForm">
            <div class="form-group">
                <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" id="login" required>
            </div>

            <div class="form-group">
                <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                <input type="email" > <!--  required>-->
                <div class="password-rules">*–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</div>
            </div>

            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="password" required minlength="6">
                <span class="password-toggle" onclick="togglePassword()">üëÅ</span>
                <div id="strength-text"></div>
            </div>

            <div class="terms">
                <input type="checkbox" id="terms" required>
                <label for="terms">–Ø –ø—Ä–∏–Ω–∏–º–∞—é —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</label>
            </div>

            <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </form>

        <div class="login-link">
            –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="index.php">–í–æ–π—Ç–∏</a>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        const passwordInput = document.getElementById('password');
        const strengthText = document.getElementById('strength-text');

        function togglePassword() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
        }

        function validatePassword(password) {
            let score = 0;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã
            if (password.length < 6) {
                return {
                    score: 0,
                    class: 'weak password-rules',
                    message: '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)',
                    color: '#ff4444'
                };
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
            const hasLower = /[a-z]/.test(password);
            const hasUpper = /[A-Z]/.test(password);
            const hasUpperRus = /[–ê-–Ø]/.test(password);
            const hasLowerRus = /[–∞-—è]/.test(password);
            const hasNumbers = /[0-9]/.test(password);
            const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);

            if (hasLower || hasLowerRus) score += 1;
            if (hasUpper || hasUpperRus) score += 1;
            if (hasNumbers) score += 1;
            if (hasSpecial) score += 1;

            if (score === 1) 
                return {
                    score: 1,
                    class: 'weak password-rules',
                    message: '–ù–µ–Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å',
                    color: '#ff4444'
                };
            
            else if (score <= 3) 
                return {
                    score: 2,
                    class: 'medium password-rules',
                    message: '–°—Ä–µ–¥–Ω—è—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å',
                    color: '#ffc107'
                };
            
            else if (score > 3) 
                return {
                    score: 3,
                    class: 'strong password-rules',
                    message: '–ù–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å',
                    color: '#00C851'
                };
        }

        passwordInput.addEventListener('input', updatePasswordStrength);
        function updatePasswordStrength() {
            password = passwordInput.value;
            strength = validatePassword(password);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            strengthText.className = strength.class;
            strengthText.textContent = strength.message;
            strengthText.style.color = strength.color;
        }


        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.stopPropagation();
            e.preventDefault();
            if (validatePassword($(this).find('#password').val()).score != 0)
                $.ajax({
                    url: '/users',
                    method: 'post',
                    async:false,
                    contentType: 'application/json',
                    data: JSON.stringify({login: $(this).find('#login').val(), password: $(this).find('#password').val()}),
                    success: function(data){alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ');},
                    error: function (jqXHR, exception) {
                    if (jqXHR.status === 0) alert('Not connect. Verify Network.');
                    else if (jqXHR.status == 400) alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + jqXHR.responseText);
                    else if (jqXHR.status == 404) alert('Requested page not found (404).');
                    else if (jqXHR.status == 500) alert('Internal Server Error (500).');
                    else if (exception === 'parsererror') alert('Requested JSON parse failed.'); // –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–≤–æ–¥ post-params => return –≤ .php, –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                    else if (exception === 'timeout') alert('Time out error.'); // —Å–µ—Ä–≤–µ—Ä –∑–∞–≤–∏—Å?
                    else if (exception === 'abort') alert('Ajax request aborted.');
                    else alert('Uncaught Error. ' + jqXHR.responseText);
                    }
                });
        });
    </script>
</body>
</html>

